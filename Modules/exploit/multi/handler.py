from posixpath import expanduser
from SpiritCore.Modules import *
from SpiritCore.Session import *
import uuid
class Module(Modules):
    Info = {
        "Name": "Spirit Handler",
        "Author": "ZSD",
        "Description": "Based on MSF's handler module, a set of backdoor management tools is designed. Spirit directly builds, creates, connects, and listens into a module.",
        "Options": (
            ("ExitFunc", "thread", True, 'Exit Function Thread Apc', None),
        ),
        "Payload": ["windows/spiriter", "Payload"],

    }
    Exst=0
    
    def Exploit(self):
        if self.Object.UsePayloadObject.Support==True:
            # write(self.Parameate)
            SessionObj = Session(self.Object)
            SessionObj.TargetOS =self.Object.UsePayloadObject.OS
            SessionObj.PayloadType=self.Object.UsePayloadObject.Types
            SessionObj.SObject=self.Object
            WriteLogs("Call Payload the Handler %s"%self.Object.UsePayloadObject.Name)
            SessionObj.start()
            try:
                SessionObj.Console("")
            except Exception as error:
                write("Error Handler:Exploit:30")
                print_error(error.__str__())
                return
        else:
            print_error("This Payload No SUPPORT SESSION")
    def Generate(self,File,Type="exe"):
        print_msg("Generate Type:%s"%Type)
        try:
            if self.Exst==1:
                try:
                    self.Object.UsePayloadObject.GenerateType="Shellcode"
                except:
                    pass

            if self.Object.UsePayloadObject.Verfily(self.Parameate,File,Type):
                self.Object.UsePayloadObject.GenerateFile()
        except Exception as error:
            print_error(error.__str__())
